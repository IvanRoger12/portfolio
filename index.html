<style id="patch-css">
    /* --- 1. Titre Principal "WOW" --- */
    .hero-title {
        position: relative;
        /* Halo lumineux + contour scintillant */
        text-shadow: 0 0 12px var(--accent), 0 0 30px var(--violet),
                     0 0 50px rgba(124, 58, 237, 0.7),
                     1px 1px 2px rgba(255, 255, 255, 0.2);
    }
    .hero-title::after {
        content: '';
        position: absolute;
        inset: -20%;
        background-image: radial-gradient(circle, rgba(255,255,255,0.4) 0%, transparent 50%);
        opacity: 0;
        transform: scale(0.5);
        transition: opacity 0.35s ease-out, transform 0.35s ease-out;
        pointer-events: none;
    }
    .hero-title:hover::after {
        opacity: 1;
        transform: scale(1.1);
    }

    /* --- 2. Ambiance IA pour "Missions Stratégiques" (#missions-projets) --- */
    #missions-projets.ai-bg::before {
        content: '';
        position: absolute;
        inset: -50%;
        z-index: -1;
        background-image: radial-gradient(circle at 20% 30%, var(--violet) 0%, transparent 25%),
                          radial-gradient(circle at 80% 70%, var(--cyan) 0%, transparent 20%);
        background-size: 200% 200%;
        opacity: 0;
        animation: aurora-pulse 12s ease-in-out infinite;
        transition: opacity 1s ease-in-out;
    }
    #missions-projets.is-visible.ai-bg::before { opacity: 0.15; }

    /* Micro-interactions sur les cartes de mission */
    #missions-projets .ms-aria:hover::before { animation-duration: 0.7s; }
    #missions-projets .ms-scoring:hover::before { animation-duration: 1s; opacity: 0.6; }
    #missions-projets .ms-clean::before { transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    #missions-projets .ms-clean:hover::before { transform: translateX(120%) !important; }

    /* --- 3. Animations "Data/BI" pour "Projets d'Analyse" (#projets-ia) --- */
    .bi-card-overlay {
        position: absolute; inset: 0; pointer-events: none;
        opacity: 0; transition: opacity 0.5s ease;
    }
    #projets-ia.is-visible .bi-card-overlay { opacity: 1; }

    /* Effet "ETL Pipe" en fond */
    .etl-flow::before {
        content: '';
        position: absolute; inset: 0; z-index: -1;
        background-image: radial-gradient(var(--accent) 1px, transparent 1px);
        background-size: 20px 20px;
        mask-image: linear-gradient(90deg, transparent, #000 20%, #000 80%, transparent);
        opacity: 0;
        animation: etl-move 3s linear infinite;
    }
    #projets-ia.is-visible .etl-flow::before { opacity: 0.1; }
    @keyframes etl-move { from { background-position: 0 0; } to { background-position: 40px 0; } }

    /* Animation "Bar Fill" */
    .bar-fill::after {
        content: '';
        position: absolute; bottom: 1rem; left: 1.25rem; height: 3px;
        width: 0;
        background-color: var(--cyan);
        transition: width 1.2s cubic-bezier(0.23, 1, 0.32, 1) 0.3s;
    }
    #projets-ia.is-visible .bar-fill::after { width: 50%; }

    /* --- 4. Accessibilité Globale --- */
    a:focus-visible, button:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 3px;
        box-shadow: 0 0 10px var(--accent);
        border-radius: 4px;
    }
    .btn-primary:hover, .btn-secondary:hover {
        box-shadow: 0 0 15px 4px rgba(167,139,250,0.5); /* Effet lumineux renforcé */
    }

    /* --- 5. Respect de `prefers-reduced-motion` --- */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }
</style>

<script id="patch-js">
document.addEventListener('DOMContentLoaded', () => {
    // --- 0. Configuration & Données ---
    const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const userData = {
        name: "Ivan Roger Nfinda",
        github: "https://github.com/IvanRoger12",
        linkedin: "https://www.linkedin.com/in/ivan-roger-nfinda/",
        email: "nfindaroger@gmail.com"
    };
    const voiceMessages = {
        fr: {
            header: "Bienvenue ! Je suis l'agent IA d’Ivan Roger Nfinda. Je peux vous guider dans ce portfolio.",
            parcours: "Voici les expériences de Monsieur Nfinda, avec impact mesurable et progression.",
            formation: "La formation reflète le parcours académique de Monsieur Nfinda et ses expertises clés.",
            'projets-ia': "Découvrez des projets Data & BI concrets, outils et insights actionnables.",
            'missions-projets': "Ce sont les missions que Monsieur Nfinda mène avec l’IA pour créer de la valeur.",
            contact: "Contactez Ivan Roger via ces liens ou en cliquant sur le badge de disponibilité."
        },
        en: { // Fallback ou pour version bilingue
            header: "Welcome! I am Ivan Roger Nfinda's AI agent. I can guide you through this portfolio.",
            parcours: "Here are Mr. Nfinda's experiences, with measurable impact and progression.",
            formation: "The education reflects Mr. Nfinda's academic journey and key expertise.",
            'projets-ia': "Discover concrete Data & BI projects, tools, and actionable insights.",
            'missions-projets': "These are the missions Mr. Nfinda leads with AI to create value.",
            contact: "Contact Ivan Roger through these links or by clicking the availability badge."
        }
    };

    // --- 1. Badge "Disponible" & Popup de Contact ---
    function patchContactInfo() {
        const badge = document.getElementById('availability-badge');
        const popup = document.getElementById('contact-popup');
        const btn = badge?.querySelector('button');

        if (!badge || !popup || !btn) return;

        // Rend le popup fonctionnel au clic
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            popup.classList.toggle('opacity-0');
            popup.classList.toggle('pointer-events-none');
        });
        document.addEventListener('click', () => popup.classList.add('opacity-0', 'pointer-events-none'));

        // Injection des informations utilisateur
        const links = {
            github: popup.querySelector('a[href*="github.com"]'),
            linkedin: popup.querySelector('a[href*="linkedin.com"]'),
            email: popup.querySelector('a[href*="mailto:"]')
        };
        if (links.github) { links.github.href = userData.github; links.github.target = "_blank"; links.github.rel = "noopener"; }
        if (links.linkedin) { links.linkedin.href = userData.linkedin; links.linkedin.target = "_blank"; links.linkedin.rel = "noopener"; }
        if (links.email) links.email.href = `mailto:${userData.email}`;
    }

    // --- 2. Animations déclenchées au scroll ---
    function initScrollAnimations() {
        if (reduceMotion) return;
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                }
            });
        }, { threshold: 0.2 });

        const missionsSection = document.getElementById('missions-projets');
        const biProjectsSection = document.getElementById('projets-ia'); // Renommer si ID différent

        if(missionsSection) {
            missionsSection.classList.add('ai-bg');
            observer.observe(missionsSection);
        }
        if(biProjectsSection) observer.observe(biProjectsSection);
    }

    // --- 3. Agent IA Vocal ---
    function initVoiceAgent() {
        const agent = document.getElementById('ia-agent');
        const avatar = document.getElementById('ia-avatar');
        const bubble = document.getElementById('ia-bubble');
        if (!agent || !avatar || !bubble || !('speechSynthesis' in window)) return;

        let currentTextToSpeak = '';
        document.body.dataset.voice = "on"; // Actif par défaut

        const updateAgentText = (entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const lang = document.documentElement.lang || 'fr';
                    const sectionId = entry.target.id;
                    const message = voiceMessages[lang][sectionId];
                    if (message) {
                        currentTextToSpeak = message;
                        bubble.textContent = message;
                        bubble.classList.add('bubble-show');
                        setTimeout(() => bubble.classList.remove('bubble-show'), 5000);
                    }
                }
            });
        };

        const observer = new IntersectionObserver(updateAgentText, { rootMargin: '-40% 0px -55% 0px' });
        document.querySelectorAll('section[id]').forEach(section => observer.observe(section));

        avatar.addEventListener('click', () => {
            if (reduceMotion) return; // Respecte les préférences
            
            // Toggle Mute/Unmute
            const isMuted = document.body.dataset.voice === 'off';
            document.body.dataset.voice = isMuted ? 'on' : 'off';
            avatar.style.borderColor = isMuted ? 'transparent' : 'var(--cyan)'; // Feedback visuel

            if (!isMuted && currentTextToSpeak) {
                speechSynthesis.cancel(); // Annule la parole précédente
                const utterance = new SpeechSynthesisUtterance(currentTextToSpeak);
                utterance.lang = document.documentElement.lang === 'fr' ? 'fr-FR' : 'en-US';
                utterance.pitch = 1.1;
                utterance.rate = 1.1;
                speechSynthesis.speak(utterance);
            } else {
                speechSynthesis.cancel();
            }
        });
    }

    // --- Initialisation de toutes les améliorations ---
    patchContactInfo();
    initScrollAnimations();
    initVoiceAgent();
});
</script>
